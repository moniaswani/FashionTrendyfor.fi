SINGLE-STAGE vs TWO-STAGE COMPARISON
====================================

SINGLE-STAGE (Current - UNDERCOUNTING):
=====================================

Image ‚Üí Claude ‚Üí JSON Output
                ‚ùå Misses: earrings, belt, bag, shoes

Process:
1. Claude sees image
2. Claude extracts items directly
3. Claude outputs JSON
Problem: Claude skips items without thinking about why

Result: ["hat", "jacket", "pants"] (3 items, should be 7-8)


TWO-STAGE (Improved - COMPLETE):
===============================

Image ‚Üí Stage 1: Describe ‚Üí Natural Language Description
                          ‚Üì
              Description ‚Üí Stage 2: Extract ‚Üí JSON Output
                          ‚úÖ Captures all items

Process:
1. Claude sees image
2. Claude describes outfit systematically (8 body areas)
3. Claude then extracts items from its description
4. Claude outputs JSON
Benefit: Claude commits to what it sees, then must deliver

Result: ["cap", "earrings", "shirt", "belt", "pants", "bag", "shoes"] (7 items, complete)


EXAMPLE: BALENCIAGA IMAGE
==========================

SINGLE-STAGE OUTPUT:
--------------------
Input: Balenciaga runway image (black outfit)

Claude's thought process (hidden):
- See cap? Yes ‚Üí add to list
- See jacket? Yes ‚Üí add to list  
- See pants? Yes ‚Üí add to list
- Check other items? [SKIPPED]

Output:
{
  "clothing_items": ["hat", "jacket", "pants"],
  "material_decomposition": {...},
  "item_colors_hex": {...},
  "item_colors_name": {...}
}

Missing: earrings, belt, handbag, shoes
Accuracy: 3/7 items = 43%


TWO-STAGE OUTPUT:
-----------------
Input: Balenciaga runway image (black outfit)

STAGE 1 DESCRIPTION:
Claude's thought process (visible):
"HEAD: Black cap on model's head
FACE/EARS: Gold earrings visible on both ears ‚Üê CAUGHT THIS
UPPER BODY: Black wrap-style dress with V-neckline
WAIST: Gold metallic belt at waist ‚Üê CAUGHT THIS
HANDS: Black leather handbag in right hand ‚Üê CAUGHT THIS
LOWER BODY: Black tailored pants
FEET: Black platform sandals ‚Üê CAUGHT THIS"

STAGE 2 EXTRACTION:
Claude must now extract based on Stage 1:
- Since description mentions cap ‚Üí include "cap"
- Since description mentions earrings ‚Üí include "earrings"
- Since description mentions wrap dress ‚Üí include "shirt"
- Since description mentions belt ‚Üí include "belt"
- Since description mentions pants ‚Üí include "pants"
- Since description mentions handbag ‚Üí include "bag"
- Since description mentions sandals ‚Üí include "shoes"

Output:
{
  "clothing_items": ["cap", "earrings", "shirt", "belt", "pants", "bag", "shoes"],
  "material_decomposition": {
    "cap": "wool",
    "earrings": "metal",
    "shirt": "cotton",
    "belt": "leather",
    "pants": "cotton",
    "bag": "leather",
    "shoes": "leather"
  },
  "item_colors_hex": {
    "cap": "#000000",
    "earrings": "#FFD700",
    "shirt": "#000000",
    "belt": "#FFD700",
    "pants": "#000000",
    "bag": "#000000",
    "shoes": "#000000"
  },
  "item_colors_name": {
    "cap": "black",
    "earrings": "gold",
    "shirt": "black",
    "belt": "gold",
    "pants": "black",
    "bag": "black",
    "shoes": "black"
  }
}

Complete: 7/7 items = 100%
Accuracy: 7/7 items = 100%


WHY STAGE 1 WORKS
=================

The description stage forces Claude to:
‚úì Examine the image systematically (8 body areas)
‚úì Commit to what it sees in writing
‚úì Make observations explicit (earrings are visible)
‚úì Identify handheld items (bag in hand)

Example of commitment:
- Single-stage: Claude skips without mentioning "bag"
- Two-stage Stage 1: Claude explicitly says "Black leather handbag in right hand"
- Two-stage Stage 2: Claude must now include "bag" because it was mentioned


WHY STAGE 2 ENFORCES COMPLETENESS
==================================

The extraction stage holds Claude accountable:
‚úì Instruction: "Every item mentioned in description MUST be in output"
‚úì Completeness check: "Total item count should be 6-10"
‚úì Accountability: If description mentioned 7 items, output must have 7

Example enforcement:
- If description says "Gold earrings" but output has no earrings ‚Üí failure
- If description says "Black handbag in hand" but output has no bag ‚Üí failure
- This creates a verification mechanism Claude must satisfy


IMPLEMENTATION STEPS
====================

1. Copy analyze_image_twostage.py function to your script

2. Update your process_images() function to use new analyze_image():
   
   Before:
   analysis = analyze_image(image_b64)
   
   After:
   analysis = analyze_image(image_b64)  # Same call, now two-stage internally

3. Monitor the Stage 1 descriptions in your output:
   
   print(f"   üìù Outfit description:\n{outfit_description}\n")
   
   This shows you what Claude is observing before extraction

4. Verify completeness in Stage 2:
   
   items_found = analysis.get("clothing_items", [])
   print(f"   ‚úÖ Found {len(items_found)} clothing items")
   
   You should see 7-10 items instead of 3-4


EXPECTED LOG OUTPUT
===================

Before (undercounting):
   ü§ñ Analyzing image with Claude (via Bedrock)...
   ‚úÖ Found 3 clothing items

After (complete):
   ü§ñ Analyzing image with Claude (via Bedrock)...
   üìù Outfit description:
   HEAD: Black cap...
   FACE/EARS: Gold earrings...
   UPPER BODY: Black wrap-style dress...
   WAIST: Gold belt...
   HANDS: Black handbag...
   LOWER BODY: Black pants...
   FEET: Black platform sandals...
   
   ‚úÖ Found 7 clothing items


TROUBLESHOOTING
===============

Problem: Stage 1 still missing earrings
Solution: Add earring examples to Stage 1 prompt:
  "Are there earrings? Even small ones count."

Problem: Stage 2 still not catching bag
Solution: Add handheld emphasis to Stage 2 prompt:
  "HANDS: What is the model holding in their hands?
   - Bag in hand: include as 'bag' or specific type
   - Clutch in hand: include as 'clutch'"

Problem: Two stage is too slow
Solution: If speed critical, accept 3-4 items instead, or cache results
